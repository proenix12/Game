<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="client/libraries/p5.dom.js"></script>
    <script src="client/libraries/p5.sound.js"></script>
    <link rel="stylesheet" type="text/css" href="client/style.css">
    <script src="client/sketch.js"></script>
</head>
<body>
<div id="load" class="loader"></div>
<main id="main">
    <canvas id="ctx" width="1000" height="500" style="border:3px solid #000000;"></canvas>
</main>
<script type="text/javascript">
    var ctx = document.getElementById("ctx").getContext('2d');
    ctx.font = '30px Arial';

    const socket = io('http://188.124.95.40:3000');

    socket.on('newPositions',function(data){
        ctx.clearRect(0,0,1000,500);
        for(var i = 0 ; i < data.player.length; i++){
            ctx.fillText(data.player[i].number, data.player[i].x, data.player[i].y);
        }
        for(var i = 0 ; i < data.bullet.length; i++){
            ctx.fillRect(data.bullet[i].x-5, data.bullet[i].y-5, 10, 10);
        }
    });

    document.onkeydown =function (event) {
        if(event.keyCode === 68) //d
            socket.emit('keyPress', {inputId: 'right', state:true});
        else if(event.keyCode === 83) //s
            socket.emit('keyPress', {inputId: 'down', state:true});
        else if(event.keyCode === 65) //a
            socket.emit('keyPress', {inputId: 'left', state:true});
        else if(event.keyCode === 87) //w
            socket.emit('keyPress', {inputId: 'up', state:true});
    }
    document.onkeyup =function (event) {
        if(event.keyCode === 68) //d
            socket.emit('keyPress', {inputId: 'right', state:false});
        else if(event.keyCode === 83) //s
            socket.emit('keyPress', {inputId: 'down', state:false});
        else if(event.keyCode === 65) //a
            socket.emit('keyPress', {inputId: 'left', state:false});
        else if(event.keyCode === 87) //w
            socket.emit('keyPress', {inputId: 'up', state:false});
    }

    $(document).ready(function () {
        $("#main").css('display', 'block');
        $("#load").css('display', 'none');
    })
    $(document).load(function () {
        $("#main").css('display', 'none');
        $("#load").css('display', 'block');
    })
</script>
</body>
</html>